source: dasmeta/rds/aws
version: 1.4.0

variables:
  identifier: rds-instance
  engine: mysql
  engine_version: "8.0"
  instance_class: db.t2.micro
  allocated_storage: 20
  storage_type: gp2
  storage_encrypted: true
  multi_az: false
  db_name: testdb
  db_username: admin
  db_password: Test1234!
  port: 3306
  publicly_accessible: false
  backup_retention_period: 7
 VPC
  subnet_ids: ${linked_workspaces.vpc.outputs.private_subnets}

  # create Security Group 
  create_security_group: true
  security_group_name: "rds-instance-sg"
  security_group_description: "Security group for RDS instance"
  
  
  ingress_with_cidr_blocks:
    cidr_blocks: "10.16.0.0/16"
    from_port: 3306
    to_port: 3306
    protocol: tcp

  # CloudWatch Alarm
  alarms:
    name: "cpu_utilization_high"
    enabled: true
    comparison_operator: "GreaterThanThreshold"
    evaluation_periods: 1
    threshold: 80
    statistic: "Average"
    period: 300
    sns_topic: "Default"

  # tegs RDS
  tags:
    Environment: test
    Project: Test-Infra-HCL
    Owner: mher-test

linked_workspaces:
  - name: vpc
    path: 1-environments/test/vpc

providers:
  - name: aws
    version: "~> 5.0"
    module_nested_provider: true
    variables:
      region: eu-central-1
      default_tags:
        tags:
          Account: mher-test
          ManageLevel: environment
