source: dasmeta/security-group/aws
version: 1.0.0

variables:
  name: "rds-mysql-sg"
  description: "Security group for RDS MySQL"

  # VPC ID is taken from the vpc workspace
  vpc_id: ${1-environments/test/vpc.vpc_id}

  ingress_with_cidr_blocks:
    - description: "Allow MySQL traffic inside VPC"
      from_port: 3306
      to_port: 3306
      protocol: tcp
      cidr_blocks:
        - "10.16.0.0/16"

  egress_with_cidr_blocks:
    - description: "Allow all outbound traffic"
      from_port: 0
      to_port: 0
      protocol: "-1"
      cidr_blocks:
        - "0.0.0.0/0"

  tags:
    Name: "rds-mysql-sg"
    Environment: "test"

linked_workspaces:
  - "1-environments/test/vpc"

providers:
  - name: aws
    version: "~> 4.0"
    module_nested_provider: true
    variables:
      region: "eu-central-1"

# REQUIRED output so other workspaces can reference this security group
outputs:
  security_group_id:
    value: ${aws_security_group.this.id}
    description: "RDS MySQL security group ID"
